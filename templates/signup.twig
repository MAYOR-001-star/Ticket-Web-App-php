{% extends "base.twig" %}

{% block title %}Sign Up - TicketX{% endblock %}

{% block content %}
<div class="flex justify-center items-center min-h-screen bg-gray-50">
  <div class="max-w-md w-full bg-white shadow-md p-8 rounded-xl">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-600">Sign Up</h1>

    <form id="signupForm" class="space-y-5">
      <div>
        <label class="block mb-1 font-medium">Name</label>
        <input
          type="text"
          name="name"
          class="w-full border rounded-md px-3 py-2"
        />
        <p class="text-red-500 text-sm hidden" id="nameError"></p>
      </div>

      <div>
        <label class="block mb-1 font-medium">Email</label>
        <input
          type="email"
          name="email"
          class="w-full border rounded-md px-3 py-2"
        />
        <p class="text-red-500 text-sm hidden" id="emailError"></p>
      </div>

      <div>
        <label class="block mb-1 font-medium">Password</label>
        <input
          type="password"
          name="password"
          class="w-full border rounded-md px-3 py-2"
        />
        <p class="text-red-500 text-sm hidden" id="passwordError"></p>
      </div>

      <button
        type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-md transition"
      >
        Create Account
      </button>

      <p class="text-center text-sm mt-3">
        Already have an account?
        <a href="/?page=login" class="text-blue-600 hover:underline">
          Log in
        </a>
      </p>
    </form>
  </div>
</div>

<!-- âœ… Toastify -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<style>
.toastify {
  border-radius: 8px !important;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  padding: 14px 20px;
}
.toastify-right {
  right: 24px !important;
}
.toastify-top {
  top: 24px !important;
}
.toastify {
  opacity: 0;
  transform: translateY(-15px);
  animation: fadeInSlideDown 0.4s forwards;
}
@keyframes fadeInSlideDown {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script>
document.getElementById("signupForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const name = this.name.value.trim();
  const email = this.email.value.trim();
  const password = this.password.value.trim();

  const nameError = document.getElementById("nameError");
  const emailError = document.getElementById("emailError");
  const passwordError = document.getElementById("passwordError");

  // Reset error visibility
  nameError.classList.add("hidden");
  emailError.classList.add("hidden");
  passwordError.classList.add("hidden");

  // Validation
  if (!name) {
    nameError.textContent = "Name is required";
    nameError.classList.remove("hidden");
    return;
  }

  if (!email) {
    emailError.textContent = "Email is required";
    emailError.classList.remove("hidden");
    return;
  }

  if (!password) {
    passwordError.textContent = "Password is required";
    passwordError.classList.remove("hidden");
    return;
  }

  const users = JSON.parse(localStorage.getItem("users")) || [];

  if (users.find(u => u.email === email)) {
    Toastify({
      text: "Email already exists!",
      duration: 3000,
      gravity: "top",
      position: "right",
      close: true,
      stopOnFocus: true,
      style: {
        background: "#ef4444",
        color: "#fff",
      },
    }).showToast();
    return;
  }

  users.push({ name, email, password });
  localStorage.setItem("users", JSON.stringify(users));

  Toastify({
    text: "Account created successfully!",
    duration: 2000,
    gravity: "top",
    position: "right",
    close: true,
    stopOnFocus: true,
    style: {
      background: "#22c55e",
      color: "#fff",
    },
  }).showToast();

  setTimeout(() => {
    window.location.href = "/?page=login";
  }, 2000);
});
</script>
{% endblock %}
