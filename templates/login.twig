{% extends "base.twig" %}

{% block title %}Login - Ticket App{% endblock %}

{% block content %}
<div class="max-w-md mx-auto my-16 bg-white shadow-md p-8 rounded-xl">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-600">
        Login
    </h1>

    <form id="loginForm" class="space-y-5">
        <div>
            <label class="block mb-1 font-medium">Email</label>
            <input
                type="email"
                name="email"
                class="w-full border rounded-md px-3 py-2"
            />
            <p class="text-red-500 text-sm hidden" id="emailError"></p>
        </div>

        <div>
            <label class="block mb-1 font-medium">Password</label>
            <input
                type="password"
                name="password"
                class="w-full border rounded-md px-3 py-2"
            />
            <p class="text-red-500 text-sm hidden" id="passwordError"></p>
        </div>

        <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-md transition"
        >
            Sign In
        </button>

        <p class="text-center text-sm mt-3">
            Donâ€™t have an account?
            <a href="/?page=signup" class="text-blue-600 hover:underline">
                Sign up
            </a>
        </p>
    </form>
</div>

<!-- Toastify -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-toastify/dist/ReactToastify.min.css">
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<script>
document.getElementById("loginForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const email = this.email.value.trim();
    const password = this.password.value.trim();

    const emailError = document.getElementById("emailError");
    const passError = document.getElementById("passwordError");

    emailError.classList.add("hidden");
    passError.classList.add("hidden");

    if(!email) {
        emailError.textContent = "Email is required";
        emailError.classList.remove("hidden");
        return;
    }

    if(!password) {
        passError.textContent = "Password is required";
        passError.classList.remove("hidden");
        return;
    }

    const users = JSON.parse(localStorage.getItem("users")) || [];
    const user = users.find(u => u.email === email && u.password === password);

    if(!user) {
        Toastify({ text: "Invalid email or password", backgroundColor: "red" }).showToast();
        return;
    }

    localStorage.setItem("ticketapp_session", JSON.stringify(user));
    Toastify({ text: "Login successful!", backgroundColor: "green" }).showToast();

    setTimeout(() => {
        window.location.href = "/?page=dashboard";
    }, 1500);
});
</script>
{% endblock %}
